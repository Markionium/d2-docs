"format register";System.register("d2/lib/utils",[],function(_export){function throwError(message){throw new Error(message)}function curry(toCurry,parameter){return"function"==typeof toCurry?function(){var args=Array.prototype.slice.call(arguments,0);return toCurry.apply(this,[parameter].concat(args))}:void 0}function addLockedProperty(object,name,value){var propertyDescriptor={enumerable:!0,configurable:!1,writable:!1,value:value};Object.defineProperty(object,name,propertyDescriptor)}function copyOwnProperties(to,from){var key;for(key in from)from.hasOwnProperty(key)&&(to[key]=from[key]);return to}function pick(property){return function(item){return item?item[property]:void 0}}return _export("throwError",throwError),_export("curry",curry),_export("addLockedProperty",addLockedProperty),_export("copyOwnProperties",copyOwnProperties),_export("pick",pick),{setters:[],execute:function(){"use strict"}}}),System.register("d2/lib/check",[],function(_export){function checkType(value,type,name){if(checkDefined(value,name),checkDefined(type,"Type"),"function"==typeof type&&value instanceof type||"string"==typeof type&&typeof value===type)return!0;throw new Error(["Expected",name||value,"to have type",type].join(" "))}function checkDefined(value,name){if(void 0!==value)return!0;throw new Error([name||"Value","should be provided"].join(" "))}function isType(value,type){try{return checkType(value,type),!0}catch(e){}return!1}function isString(value){return isType(value,"string")}function isArray(value){return Array.isArray(value)}function isObject(value){return isType(value,Object)}function isDefined(value){return void 0!==value}function isInteger(nVal){return"number"==typeof nVal&&isFinite(nVal)&&nVal>-9007199254740992&&9007199254740992>nVal&&Math.floor(nVal)===nVal}function isNumeric(nVal){return"number"==typeof nVal&&isFinite(nVal)&&nVal-parseFloat(nVal)+1>=0}function contains(item,list){return list=isArray(list)&&list||[],list.indexOf(item)>=0}function isValidUid(value){return value&&11===value.length}return _export("checkType",checkType),_export("checkDefined",checkDefined),_export("isType",isType),_export("isString",isString),_export("isArray",isArray),_export("isObject",isObject),_export("isDefined",isDefined),_export("isInteger",isInteger),_export("isNumeric",isNumeric),_export("contains",contains),_export("isValidUid",isValidUid),{setters:[],execute:function(){"use strict";Number.isInteger||(Number.isInteger=isInteger),_export("default",{checkType:checkType,checkDefined:checkDefined,isArray:isArray,isDefined:isDefined,isInteger:isInteger,isNumeric:isNumeric,isString:isString,isType:isType,contains:contains,isValidUid:isValidUid})}}}),System.register("d2/logger/Logger",["d2/lib/check"],function(_export){var checkType,isType,console,Logger;return{setters:[function(_d2LibCheck){checkType=_d2LibCheck.checkType,isType=_d2LibCheck.isType}],execute:function(){"use strict";Logger=function(){function Logger(logging){babelHelpers.classCallCheck(this,Logger),checkType(logging,"object","console"),console=logging}return babelHelpers.createClass(Logger,[{key:"canLog",value:function(type){return!!(type&&console&&isType(console[type],"function"))}},{key:"debug",value:function(){for(var _len=arguments.length,rest=Array(_len),_key=0;_len>_key;_key++)rest[_key]=arguments[_key];return this.canLog("debug")?(console.debug.apply(console,rest),!0):!1}},{key:"error",value:function(){for(var _len2=arguments.length,rest=Array(_len2),_key2=0;_len2>_key2;_key2++)rest[_key2]=arguments[_key2];return this.canLog("error")?(console.log(arguments),console.error.apply(console,rest),!0):!1}},{key:"log",value:function(){for(var _len3=arguments.length,rest=Array(_len3),_key3=0;_len3>_key3;_key3++)rest[_key3]=arguments[_key3];return this.canLog("log")?(console.log.apply(console,rest),!0):!1}},{key:"warn",value:function(){for(var _len4=arguments.length,rest=Array(_len4),_key4=0;_len4>_key4;_key4++)rest[_key4]=arguments[_key4];return this.canLog("warn")?(console.warn.apply(console,rest),!0):!1}}]),Logger}(),Logger.getLogger=function(){var console;try{console=global.console}catch(e){console=window.console}return this.logger?this.logger:this.logger=new Logger(console)},_export("default",Logger)}}}),System.register("d2/external/jquery",[],function(_export){return{setters:[],execute:function(){"use strict";_export("default",window.jQuery)}}}),System.register("d2/model/Model",["d2/lib/check","d2/model/ModelBase"],function(_export){var checkType,ModelBase,Model;return{setters:[function(_d2LibCheck){checkType=_d2LibCheck.checkType},function(_d2ModelModelBase){ModelBase=_d2ModelModelBase["default"]}],execute:function(){"use strict";Model=function(){function Model(modelDefinition){babelHelpers.classCallCheck(this,Model),checkType(modelDefinition,"object","modelDefinition"),checkType(modelDefinition.modelProperties,"object","modelProperties"),Object.defineProperty(this,"modelDefinition",{enumerable:!1,configurable:!1,writable:!1,value:modelDefinition}),Object.defineProperty(this,"dirty",{enumerable:!1,configurable:!1,writable:!0,value:!1}),Object.defineProperty(this,"dataValues",{enumerable:!1,configurable:!0,writable:!0,value:{}}),Object.defineProperties(this,modelDefinition.modelProperties)}return babelHelpers.createClass(Model,null,[{key:"create",value:function(modelDefinition){return new Model(modelDefinition)}}]),Model}(),Model.prototype=ModelBase,_export("default",Model)}}}),System.register("d2/pager/Pager",["d2/lib/check"],function(_export){var isDefined,Pager;return{setters:[function(_d2LibCheck){isDefined=_d2LibCheck.isDefined}],execute:function(){"use strict";Pager=function(){function Pager(){var pager=void 0===arguments[0]?{page:1,pageCount:1}:arguments[0],pagingHandler=void 0===arguments[1]?{list:function(){return Promise.reject("No handler available")}}:arguments[1];babelHelpers.classCallCheck(this,Pager),this.page=pager.page,this.pageCount=pager.pageCount,this.total=pager.total,this.nextPage=pager.nextPage,this.prevPage=pager.prevPage,this.pagingHandler=pagingHandler}return babelHelpers.createClass(Pager,[{key:"hasNextPage",value:function(){return isDefined(this.nextPage)}},{key:"hasPreviousPage",value:function(){return isDefined(this.prevPage)}},{key:"getNextPage",value:function(){return this.hasNextPage()?this.goToPage(this.page+1):Promise.reject("There is no next page for this collection")}},{key:"getPreviousPage",value:function(){return this.hasPreviousPage()?this.goToPage(this.page-1):Promise.reject("There is no previous page for this collection")}},{key:"goToPage",value:function(pageNr){if(1>pageNr)throw new Error("PageNr can not be less than 1");if(pageNr>this.pageCount)throw new Error("PageNr can not be larger than the total page count of "+this.pageCount);return this.pagingHandler.list({page:pageNr})}}]),Pager}(),_export("default",Pager)}}}),System.register("d2/lib/SchemaTypes",["d2/lib/utils","d2/lib/check"],function(_export){var throwError,isString,SchemaTypes;return{setters:[function(_d2LibUtils){throwError=_d2LibUtils.throwError},function(_d2LibCheck){isString=_d2LibCheck.isString}],execute:function(){"use strict";SchemaTypes=function(){function SchemaTypes(){babelHelpers.classCallCheck(this,SchemaTypes)}return babelHelpers.createClass(SchemaTypes,[{key:"getTypes",value:function(){return["TEXT","NUMBER","INTEGER","BOOLEAN","EMAIL","PASSWORD","URL","PHONENUMBER","GEOLOCATION","COLOR","COMPLEX","COLLECTION","REFERENCE","DATE","COMPLEX","IDENTIFIER","CONSTANT"]}},{key:"typeLookup",value:function(propertyType){return this.getTypes().indexOf(propertyType)>=0&&isString(propertyType)?propertyType:void throwError(['Type from schema "',propertyType,'" not found available type list.'].join(""))}}]),SchemaTypes}(),_export("default",new SchemaTypes)}}}),System.register("d2/model/ModelDefinitions",["d2/lib/check"],function(_export){var checkType,ModelDefinitions;return{setters:[function(_d2LibCheck){checkType=_d2LibCheck.checkType}],execute:function(){"use strict";ModelDefinitions=function(){function ModelDefinitions(){babelHelpers.classCallCheck(this,ModelDefinitions)}return babelHelpers.createClass(ModelDefinitions,[{key:"add",value:function(modelDefinition){try{checkType(modelDefinition.name,"string")}catch(e){throw new Error("Name should be set on the passed ModelDefinition to add one")}if(this[modelDefinition.name])throw new Error(["Model",modelDefinition.name,"already exists"].join(" "));this[modelDefinition.name]=modelDefinition}},{key:"mapThroughDefinitions",value:function(transformer){var modelDefinition,result=[];for(modelDefinition in this)this.hasOwnProperty(modelDefinition)&&result.push(transformer(this[modelDefinition]));return result}}]),ModelDefinitions}(),_export("default",ModelDefinitions)}}}),System.register("d2/api/Api",["d2/lib/check","d2/lib/utils","d2/external/jquery"],function(_export){function getApi(){return getApi.api?getApi.api:getApi.api=new Api(jQuery)}function processSuccess(resolve){return function(data){resolve(data)}}function processFailure(reject){return function(jqXHR){delete jqXHR.then,reject(jqXHR)}}function getUrl(baseUrl,url){if(new RegExp("^(:?https?:)?//").test(url))return url;var urlParts=[];return baseUrl&&urlParts.push(baseUrl),urlParts.push(url),urlParts.join("/").replace(new RegExp("(.(?:[^:]))//+","g"),"$1/").replace(new RegExp("/$"),"")}var checkType,copyOwnProperties,jQuery,Api;return{setters:[function(_d2LibCheck){checkType=_d2LibCheck.checkType},function(_d2LibUtils){copyOwnProperties=_d2LibUtils.copyOwnProperties},function(_d2ExternalJquery){jQuery=_d2ExternalJquery["default"]}],execute:function(){"use strict";Api=function(){function Api(jquery){babelHelpers.classCallCheck(this,Api),this.jquery=jquery,this.baseUrl="/api",this.defaultRequestSettings={data:{},contentType:"application/json",dataType:"json",type:void 0,url:void 0}}return babelHelpers.createClass(Api,[{key:"get",value:function(url,data){return this.request("GET",getUrl(this.baseUrl,url),data)}},{key:"post",value:function(url,data){return this.request("POST",getUrl(this.baseUrl,url),JSON.stringify(data))}},{key:"remove",value:function(){}},{key:"update",value:function(url,data){return this.request("PUT",url,JSON.stringify(data))}},{key:"request",value:function(type,url,data){function getOptions(mergeOptions){var options={};return copyOwnProperties(options,api.defaultRequestSettings),copyOwnProperties(options,mergeOptions),options}checkType(type,"string","Request type"),checkType(url,"string","Url");var api=this;return new Promise(function(resolve,reject){api.jquery.ajax(getOptions({type:type,url:url,data:data||{}})).then(processSuccess(resolve),processFailure(reject))})}},{key:"setBaseUrl",value:function(baseUrl){return checkType(baseUrl,"string","Base url"),this.baseUrl=baseUrl,this}}]),Api}(),Api.getApi=getApi,_export("default",Api)}}}),System.register("d2/model/ModelCollection",["d2/lib/check","d2/lib/utils","d2/model/Model","d2/model/ModelDefinition","d2/pager/Pager"],function(_export){function throwIfContainsOtherThanModelObjects(values){if(values&&values[Symbol.iterator]){var toCheck=[].concat(babelHelpers.toConsumableArray(values));toCheck.forEach(function(value){value instanceof Model||throwError("Values of a ModelCollection must be instances of Model")})}}function throwIfContainsModelWithoutUid(values){if(values&&values[Symbol.iterator]){var toCheck=[].concat(babelHelpers.toConsumableArray(values));toCheck.forEach(function(value){isValidUid(value.id)||throwError("Can not add a Model without id to a ModelCollection")})}}var isValidUid,isArray,checkType,throwError,Model,ModelDefinition,Pager,ModelCollection;return{setters:[function(_d2LibCheck){isValidUid=_d2LibCheck.isValidUid,isArray=_d2LibCheck.isArray,checkType=_d2LibCheck.checkType},function(_d2LibUtils){throwError=_d2LibUtils.throwError},function(_d2ModelModel){Model=_d2ModelModel["default"]},function(_d2ModelModelDefinition){ModelDefinition=_d2ModelModelDefinition["default"]},function(_d2PagerPager){Pager=_d2PagerPager["default"]}],execute:function(){"use strict";ModelCollection=function(){function ModelCollection(modelDefinition,values,pagerData){var _this=this;babelHelpers.classCallCheck(this,ModelCollection),checkType(modelDefinition,ModelDefinition),this.modelDefinition=modelDefinition,this.pager=new Pager(pagerData,modelDefinition),this.valuesContainerMap=new Map,this[Symbol.iterator]=this.valuesContainerMap[Symbol.iterator].bind(this.valuesContainerMap),throwIfContainsOtherThanModelObjects(values),throwIfContainsModelWithoutUid(values),isArray(values)&&values.forEach(function(value){return _this.add(value)})}return babelHelpers.createClass(ModelCollection,[{key:"size",get:function(){return this.valuesContainerMap.size}},{key:"add",value:function(value){return throwIfContainsOtherThanModelObjects([value]),throwIfContainsModelWithoutUid([value]),this.set(value.id,value),this}},{key:"toArray",value:function(){var resultArray=[];return this.forEach(function(model){resultArray.push(model)}),resultArray}},{key:"clear",value:function(){return this.valuesContainerMap.clear.apply(this.valuesContainerMap)}},{key:"delete",value:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];return this.valuesContainerMap["delete"].apply(this.valuesContainerMap,args)}},{key:"entries",value:function(){return this.valuesContainerMap.entries.apply(this.valuesContainerMap)}},{key:"forEach",value:function(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_len2>_key2;_key2++)args[_key2]=arguments[_key2];return this.valuesContainerMap.forEach.apply(this.valuesContainerMap,args)}},{key:"get",value:function(){for(var _len3=arguments.length,args=Array(_len3),_key3=0;_len3>_key3;_key3++)args[_key3]=arguments[_key3];return this.valuesContainerMap.get.apply(this.valuesContainerMap,args)}},{key:"has",value:function(){for(var _len4=arguments.length,args=Array(_len4),_key4=0;_len4>_key4;_key4++)args[_key4]=arguments[_key4];return this.valuesContainerMap.has.apply(this.valuesContainerMap,args)}},{key:"keys",value:function(){return this.valuesContainerMap.keys.apply(this.valuesContainerMap)}},{key:"set",value:function(){for(var _len5=arguments.length,args=Array(_len5),_key5=0;_len5>_key5;_key5++)args[_key5]=arguments[_key5];return this.valuesContainerMap.set.apply(this.valuesContainerMap,args)}},{key:"values",value:function(){return this.valuesContainerMap.values.apply(this.valuesContainerMap)}}],[{key:"create",value:function(modelDefinition,values,pagerData){return new ModelCollection(modelDefinition,values,pagerData)}}]),ModelCollection}(),_export("default",ModelCollection)}}}),System.register("d2/model/ModelValidation",["d2/lib/check","d2/logger/Logger","d2/api/Api"],function(_export){function typeValidation(value,type){switch(type){case"INTEGER":return isInteger(value);case"NUMBER":return isNumeric(value);case"COLLECTION":return isArray(value);case"PHONENUMBER":case"EMAIL":case"URL":case"COLOR":case"PASSWORD":case"IDENTIFIER":case"TEXT":return isString(value);case"COMPLEX":return isObject(value);case"DATE":case"REFERENCE":case"BOOLEAN":case"CONSTANT":return!0;default:logger.log("No type validator found for",type)}return!1}function numberMinMaxValidation(value,validationSettings){var resultStatus={status:!0,messages:[]};return isNumeric(value)&&(isLargerThanMin(value,validationSettings.min)||(resultStatus.status=!1,resultStatus.messages.push({message:["Value needs to be larger than or equal to",validationSettings.min].join(" "),value:value})),isSmallerThanMax(value,validationSettings.max)||(resultStatus.status=!1,resultStatus.messages.push({message:["Value needs to be smaller than or equal to",validationSettings.max].join(" "),value:value}))),resultStatus}function minMaxValidation(result,value,validationSettings){var numberMinMaxValidationStatus=numberMinMaxValidation(value,validationSettings);numberMinMaxValidationStatus.status||(result.status=!1,result.messages=result.messages.concat(numberMinMaxValidationStatus.messages));var lengthMinMaxValidationStatus=lengthMinMaxValidation(value,validationSettings);return lengthMinMaxValidationStatus.status||(result.status=!1,result.messages=result.messages.concat(lengthMinMaxValidationStatus.messages)),result}function lengthMinMaxValidation(value,validationSettings){var resultStatus={status:!0,messages:[]};return(isArray(value)||isString(value))&&(isLargerThanLength(value,validationSettings.min)||(resultStatus.status=!1,resultStatus.messages.push({message:["Value needs to be longer than or equal to",validationSettings.min].join(" "),value:value})),isSmallerThanLength(value,validationSettings.max)||(resultStatus.status=!1,resultStatus.messages.push({message:["Value needs to be shorter than or equal to",validationSettings.max].join(" "),value:value}))),resultStatus}function isLargerThanMin(value,minValue){return isNumeric(minValue)?value>=minValue:!0}function isSmallerThanMax(value,maxValue){return isNumeric(maxValue)?maxValue>=value:!0}function isLargerThanLength(value,minValue){return isInteger(minValue)?Boolean(value&&isInteger(value.length)&&value.length>=minValue):!0}function isSmallerThanLength(value,maxValue){return isInteger(maxValue)?Boolean(value&&isInteger(value.length)&&value.length<=maxValue):!0}function typeSpecificValidation(result,value,valueType){return valueType&&isArray(typeSpecificValidations[valueType])?void(result.status=typeSpecificValidations[valueType].reduce(function(currentValidationStatus,customValidator){return customValidator.validator.apply(null,[value])||(result.messages.push({message:customValidator.message,value:value}),currentValidationStatus=!1),currentValidationStatus},!0)):result}function phoneNumber(value){return phoneNumberRegEx.test(value)}var checkType,isInteger,isObject,isArray,isString,isNumeric,Logger,Api,logger,typeSpecificValidations,ModelValidation,phoneNumberRegEx;return{setters:[function(_d2LibCheck){checkType=_d2LibCheck.checkType,isInteger=_d2LibCheck.isInteger,isObject=_d2LibCheck.isObject,isArray=_d2LibCheck.isArray,isString=_d2LibCheck.isString,isNumeric=_d2LibCheck.isNumeric},function(_d2LoggerLogger){Logger=_d2LoggerLogger["default"]},function(_d2ApiApi){Api=_d2ApiApi["default"]}],execute:function(){"use strict";logger=void 0,typeSpecificValidations={PHONENUMBER:[{message:"Phone number can only consist of numbers and + and [space]",validator:phoneNumber}]},ModelValidation=function(){function ModelValidation(providedLogger){babelHelpers.classCallCheck(this,ModelValidation),checkType(providedLogger,"object","logger (Logger)"),logger=providedLogger}return babelHelpers.createClass(ModelValidation,[{key:"validate",value:function(validationSettings,value){if(!isObject(validationSettings))throw new TypeError("validationSettings should be of type object");var result={status:!0,messages:[]};return validationSettings.required!==!1||value?(typeValidation(value,validationSettings.type)||(result.status=!1,result.messages.push({message:"This is not a valid type",value:value})),minMaxValidation(result,value,validationSettings),typeSpecificValidation(result,value,validationSettings.type),result):{status:!0,messages:[]}}},{key:"validateAgainstSchema",value:function(model){return model&&model.modelDefinition&&model.modelDefinition.name?Api.getApi().post(["schemas",model.modelDefinition.name].join("/"),model.modelDefinition.getOwnedPropertyJSON(model)):Promise.reject("model.modelDefinition.name can not be found")}}],[{key:"getModelValidation",value:function(){return this.modelValidation?this.modelValidation:this.modelValidation=new ModelValidation(Logger.getLogger(console))}}]),ModelValidation}(),phoneNumberRegEx=/^[0-9\+ ]+$/,_export("default",ModelValidation)}}}),System.register("d2/model/ModelDefinition",["d2/lib/check","d2/lib/utils","d2/model/Model","d2/model/ModelCollection","d2/lib/SchemaTypes"],function(_export){function createPropertiesObject(schemaProperties){var propertiesObject={},createModelPropertyDescriptorOn=curry(createModelPropertyDescriptor,propertiesObject);return(schemaProperties||[]).forEach(createModelPropertyDescriptorOn),propertiesObject}function createModelPropertyDescriptor(propertiesObject,schemaProperty){var propertyName=schemaProperty.collection?schemaProperty.collectionName:schemaProperty.name,propertyDetails={configurable:!1,enumerable:!0,get:function(){return this.dataValues[propertyName]}};schemaProperty.writable&&(propertyDetails.set=function(value){(!isObject(value)&&value!==this.dataValues[propertyName]||isObject(value))&&(this.dirty=!0,this.dataValues[propertyName]=value)}),propertyName&&(propertiesObject[propertyName]=propertyDetails)}function createValidations(schemaProperties){var validationsObject={},createModelPropertyOn=curry(createValidationSetting,validationsObject);return(schemaProperties||[]).forEach(createModelPropertyOn),validationsObject}function createValidationSetting(validationObject,schemaProperty){function getReferenceTypeFrom(schemaProperty){function isStringContains(text,contains){return text.toLowerCase().indexOf(contains.toLowerCase())>=0}function lowerCaseFirstLetter(text){return text.charAt(0).toLowerCase()+text.slice(1)}var classPart=void 0,owningRolePart=void 0;try{classPart=schemaProperty.klass.split(".").reverse()[0],owningRolePart=schemaProperty.owningRole.split(".").reverse()[0]}catch(e){return void 0}return isStringContains(classPart,owningRolePart)?lowerCaseFirstLetter(owningRolePart):isStringContains(owningRolePart,classPart)?lowerCaseFirstLetter(classPart):void 0}var propertyName=schemaProperty.collection?schemaProperty.collectionName:schemaProperty.name,validationDetails={persisted:schemaProperty.persisted,type:schemaTypes.typeLookup(schemaProperty.propertyType),required:schemaProperty.required,min:schemaProperty.min,max:schemaProperty.max,owner:schemaProperty.owner,unique:schemaProperty.unique,writable:schemaProperty.writable,constants:schemaProperty.constants};"REFERENCE"===validationDetails.type&&(validationDetails.referenceType=getReferenceTypeFrom(schemaProperty)),propertyName&&(validationObject[propertyName]=validationDetails)}var checkType,isObject,checkDefined,addLockedProperty,curry,Model,ModelCollection,schemaTypes,ModelDefinition,UserModelDefinition;return{setters:[function(_d2LibCheck){checkType=_d2LibCheck.checkType,isObject=_d2LibCheck.isObject,checkDefined=_d2LibCheck.checkDefined},function(_d2LibUtils){addLockedProperty=_d2LibUtils.addLockedProperty,curry=_d2LibUtils.curry},function(_d2ModelModel){Model=_d2ModelModel["default"]},function(_d2ModelModelCollection){ModelCollection=_d2ModelModelCollection["default"]},function(_d2LibSchemaTypes){schemaTypes=_d2LibSchemaTypes["default"]}],execute:function(){"use strict";ModelDefinition=function(){function ModelDefinition(modelName,modelNamePlural,modelOptions,properties,validations){babelHelpers.classCallCheck(this,ModelDefinition),checkType(modelName,"string"),checkType(modelNamePlural,"string","Plural"),addLockedProperty(this,"name",modelName),addLockedProperty(this,"plural",modelNamePlural),addLockedProperty(this,"isMetaData",modelOptions&&modelOptions.metadata||!1),addLockedProperty(this,"apiEndpoint",modelOptions&&modelOptions.apiEndpoint),addLockedProperty(this,"modelProperties",properties),addLockedProperty(this,"modelValidations",validations)}return babelHelpers.createClass(ModelDefinition,[{key:"create",value:function(data){var model=Model.create(this);return data&&Object.keys(model).forEach(function(key){model.dataValues[key]=data[key]}),model}},{key:"get",value:function(identifier){var _this=this,queryParams=void 0===arguments[1]?{fields:":all"}:arguments[1];return checkDefined(identifier,"Identifier"),this.api.get([this.apiEndpoint,identifier].join("/"),queryParams).then(function(data){return _this.create(data)})["catch"](function(response){return Promise.reject(response.data)})}},{key:"list",value:function(){var _this2=this,queryParams=void 0===arguments[0]?{fields:":all"}:arguments[0];return this.api.get(this.apiEndpoint,queryParams).then(function(data){return ModelCollection.create(_this2,data[_this2.plural].map(function(data){return _this2.create(data)}),data.pager)})}},{key:"save",value:function(model){var isAnUpdate=function(model){return!!model.id};return isAnUpdate(model)?this.api.update(model.dataValues.href,this.getOwnedPropertyJSON(model)):this.api.post(this.apiEndpoint,this.getOwnedPropertyJSON(model))}},{key:"getOwnedPropertyJSON",value:function(model){var objectToSave={},ownedProperties=this.getOwnedPropertyNames();return Object.keys(this.modelValidations).forEach(function(propertyName){ownedProperties.includes(propertyName)&&model.dataValues[propertyName]&&(objectToSave[propertyName]=model.dataValues[propertyName])}),objectToSave}},{key:"getOwnedPropertyNames",value:function(){var _this3=this;return Object.keys(this.modelValidations).filter(function(propertyName){return _this3.modelValidations[propertyName].owner})}}],[{key:"createFromSchema",value:function(schema){var ModelDefinitionClass=void 0;return checkType(schema,Object,"Schema"),ModelDefinitionClass="function"==typeof ModelDefinition.specialClasses[schema.name]?ModelDefinition.specialClasses[schema.name]:ModelDefinition,Object.freeze(new ModelDefinitionClass(schema.name,schema.plural,schema,Object.freeze(createPropertiesObject(schema.properties)),Object.freeze(createValidations(schema.properties))))}}]),ModelDefinition}(),UserModelDefinition=function(_ModelDefinition){function UserModelDefinition(){babelHelpers.classCallCheck(this,UserModelDefinition),null!=_ModelDefinition&&_ModelDefinition.apply(this,arguments)}return babelHelpers.inherits(UserModelDefinition,_ModelDefinition),babelHelpers.createClass(UserModelDefinition,[{key:"get",value:function(identifier){var queryParams=void 0===arguments[1]?{fields:":all,userCredentials[:owner]"}:arguments[1];return babelHelpers.get(Object.getPrototypeOf(UserModelDefinition.prototype),"get",this).call(this,identifier,queryParams)}}]),UserModelDefinition}(ModelDefinition),ModelDefinition.specialClasses={user:UserModelDefinition},_export("default",ModelDefinition)}}}),System.register("d2/model/ModelBase",["d2/model/ModelValidation"],function(_export){var ModelValidation,modelValidator,ModelBase;return{setters:[function(_d2ModelModelValidation){ModelValidation=_d2ModelModelValidation["default"]}],execute:function(){"use strict";modelValidator=ModelValidation.getModelValidation(),ModelBase=function(){function ModelBase(){babelHelpers.classCallCheck(this,ModelBase)}return babelHelpers.createClass(ModelBase,[{key:"save",value:function(){var _this=this;return this.dirty?this.validate().then(function(validationState){return validationState.status?_this.modelDefinition.save(_this).then(function(){return _this.dirty=!1}):Promise.reject(validationState)}):Promise.reject("No changes to be saved")}},{key:"validate",value:function(){var _this2=this;return new Promise(function(resolve,reject){function unique(current,property){return property&&-1===current.indexOf(property)&&current.push(property),current}function localValidation(modelValidations,dataValues){var validationMessagesLocal=[];return Object.keys(modelValidations).forEach(function(propertyName){var validationStatus=modelValidator.validate(modelValidations[propertyName],dataValues[propertyName]);validationStatus.status||validationStatus.messages.forEach(function(message){message.property=propertyName}),modelValidationStatus=modelValidationStatus&&validationStatus.status,validationMessagesLocal=validationMessagesLocal.concat(validationStatus.messages||[])}),validationMessagesLocal}function asyncRemoteValidation(model){return modelValidator.validateAgainstSchema(model)}var modelValidationStatus=!0,validationMessages=[],validationState=void 0;validationMessages=validationMessages.concat(localValidation(_this2.modelDefinition.modelValidations,_this2.dataValues)),asyncRemoteValidation(_this2).then(function(remoteMessages){validationMessages=validationMessages.concat(remoteMessages),validationState={status:modelValidationStatus,fields:validationMessages.map(function(validationMessage){return validationMessage.property}).reduce(unique,[]),messages:validationMessages},resolve(validationState)})["catch"](function(message){return reject(message)})})}}]),ModelBase}(),_export("default",new ModelBase)}}}),System.register("d2/model/models",["d2/model/ModelBase","d2/model/Model","d2/model/ModelDefinition","d2/model/ModelDefinitions","d2/model/ModelValidation"],function(_export){var ModelBase,Model,ModelDefinition,ModelDefinitions,ModelValidation;return{setters:[function(_d2ModelModelBase){ModelBase=_d2ModelModelBase["default"]},function(_d2ModelModel){Model=_d2ModelModel["default"]},function(_d2ModelModelDefinition){ModelDefinition=_d2ModelModelDefinition["default"]},function(_d2ModelModelDefinitions){ModelDefinitions=_d2ModelModelDefinitions["default"]},function(_d2ModelModelValidation){ModelValidation=_d2ModelModelValidation["default"]}],execute:function(){"use strict";_export("default",{ModelBase:ModelBase,Model:Model,ModelDefinition:ModelDefinition,ModelDefinitions:ModelDefinitions,ModelValidations:ModelValidation})}}}),System.register("d2",["d2/lib/utils","d2/lib/check","d2/logger/Logger","d2/model/models","d2/api/Api"],function(_export){function d2Init(config){var logger=Logger.getLogger(),d2={models:void 0,model:model,Api:Api},api=Api.getApi();return config&&checkType(config,"object","Config parameter")&&processConfig(api,config),model.ModelDefinition.prototype.api=api,d2.models=new model.ModelDefinitions,api.get("schemas").then(pick("schemas")).then(function(schemas){return schemas.forEach(function(schema){d2.models.add(model.ModelDefinition.createFromSchema(schema))}),d2})["catch"](function(error){return logger.error("Unable to get schemas from the api",error),Promise.reject(error)})}function processConfig(api,config){api.setBaseUrl(isString(config.baseUrl)?config.baseUrl:"/api")}var pick,checkType,isString,Logger,model,Api;return{setters:[function(_d2LibUtils){pick=_d2LibUtils.pick},function(_d2LibCheck){checkType=_d2LibCheck.checkType,isString=_d2LibCheck.isString},function(_d2LoggerLogger){Logger=_d2LoggerLogger["default"]},function(_d2ModelModels){model=_d2ModelModels["default"]},function(_d2ApiApi){Api=_d2ApiApi["default"]}],execute:function(){"use strict";"undefined"!=typeof window&&(window.d2=d2Init),_export("default",d2Init)}}});
//# sourceMappingURL=d2.js.map